# 実装ガイド

## 1. 事前準備
- GMO コインの API キーを取得し、`.env` に設定
```
API_KEY=xxxx
API_SECRET=yyyy
EXCHANGE=gmocoin
SYMBOL=BTC_JPY
TRADE_SIZE=0.001
```
- Python 3.11+ と docker-compose が利用可能であることを確認

## 2. ローカル起動（docker-compose）
```bash
docker-compose up --build
```
- FastAPI: `http://localhost:8000/health`
- bot ログ: `docker logs -f trade_bot`（コンテナ名は compose の service 名に合わせる）

## 3. bot の挙動メモ
- WS 購読：ticker / orderbooks / trades
- REST：`/v1/order`（発注）、`/v1/cancelOrder`（取消）、`/v1/account/assets`（残高）
- 認証：HMAC-SHA256 署名。API キーは .env 経由で注入
- 失敗時は短いスリープの後に再接続/リトライ

## 4. 売買ロジック
初期はシンプルな移動平均ベースなどで開始し、Strategy クラスで差し替え可能にする。
```python
def decide_signal(tick):
    price = float(tick["last"])
    if price > prev_ma: return "BUY"
    if price < prev_ma: return "SELL"
    return None
```

## 5. ログと DB
- `trade_log` に timestamp, price, side, size, order_id, status, message を保存
- `bot_status` に is_running, last_ws_heartbeat, last_signal, last_order_id を保存
- stdout にも構造化 JSON を出力し docker logs で確認可能にする

## 6. FastAPI の役割
- `/health` `/bot/status` `/logs` を提供（停止・再起動などの制御は行わない）
- DB を参照して情報を返す。bot とプロセス/コンテナを分離

## 7. デプロイ指針
- VPS/AWS などの常時稼働環境で `restart: unless-stopped`
- .env の秘密情報を安全に管理（Vault/Parameter Store なども検討）
- ログ永続化（DB ボリューム）、監視は docker logs か API で行う
