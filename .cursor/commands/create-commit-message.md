# コミットメッセージ作成とコミット実行

現在ステージングされている変更内容を確認し、適切なコミットメッセージを生成してコミットを実行します。

## 処理フロー

1. **ステージング内容の確認**
   ```bash
   git diff --cached --stat
   git diff --cached --name-only
   ```
   - 変更ファイルと統計情報を取得
   - ファイルの追加（A）、変更（M）、削除（D）、リネーム（R）を識別

2. **コミットメッセージ候補の生成**
   - 変更内容を分析して、以下の情報を含むコミットメッセージを生成：
     - 変更の種類（新規追加、修正、リファクタリングなど）
     - 影響範囲（どのファイル/ディレクトリが変更されたか）
     - 主な変更内容の要約
   - **複数の候補を番号付きで提示**（簡潔版と詳細版、通常2-3個）

3. **ユーザーによる選択・編集**
   - 提示された候補を番号で選択（例: `1`、`2`、`3`）
   - または、ユーザーが直接編集したメッセージを提供
   - 選択/編集されたメッセージを確認表示

4. **コミット実行**
   - 確定したメッセージで `git commit -m "メッセージ"` を実行
   - コミット結果を確認

## コミットメッセージの形式

### 参考
[Semantic Commit Message](https://gist.github.com/joshbuchea/6f47e86d2510bce28f8e7f42ae84c716)

### フォーマット
Conventional Commits 形式をもとに1行目は以下のフォーマットを使用してください。
日本語でのコミットメッセージを作成してください。
フォーマット: `<Type>(<Scope>): <Emoji> #<IssueNumber> <Subject>`

**`<Type>`**

|Type| 説明|
|---|---|
|feat|ユーザーにとっては新しい機能であり、ビルド スクリプトにとっては新しい機能ではありません|
|fix|ビルド スクリプトの修正ではなく、ユーザー向けのバグ修正|
|docs|ドキュメントの変更|
|style|フォーマット、セミコロンの欠落など。製品コードの変更はありません|
|refactor|プロダクションコードのリファクタリング、例: 変数名の変更|
|test|不足しているテストの追加、テストのリファクタリング。本番環境のコード変更はなし|
|chore|タスクファイルなど本番環境に影響のない修正|

**`<Scope>`**

省略は可能です。変更箇所の特定、粒度を決める役割です。
例えば、
- login: ログイン機能
- api: API 機能追加
- auth: 認証機能
- ui: フロントエンドの修正
など

**`<Emoji>`**

Typeをより"カラフル"にするためにEmojiを書きます
何でも構いませんが[gitmoji](https://gitmoji.dev/)から選ぶのが便利だと思います
ただし、Emojiを覚えるコストがあるので必須ではありません

**`<IssueNumber>`**

コミットに紐づく Issue 番号を記載する。Issue を作っていなければ省略可


**`<Subject>`**

いわゆる変更内容を書く。現在型で「◯◯した」ではなく「◯◯する」と書く。
文字数は特に制限はないが、20 ~ 30 文字以内が適切だと思います。

## 実装の詳細

### ステップ1: ステージング内容の確認
```bash
git diff --cached --stat
git diff --cached --name-only
```

### ステップ2: コミットメッセージ候補の生成と提示
以下の形式で複数の候補を提示：

```
ステージング内容を確認しました。以下のコミットメッセージ候補を提案します：

[1] 簡潔版（1行）
    例: test(infrastructure): 🧪 Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する

[2] 詳細版（複数行）
    例: test(infrastructure): 🧪 Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する

    新規追加:
    - GmoWebSocketClient.test.ts (14 tests)
    - GmoAdapter.test.ts (14 tests)
    - WebSocketConnection.test.ts (15 tests)

    ディレクトリ構造の整理:
    - 既存テストファイルを src の構造に合わせて移動（git mv）
    - tests/README.md を更新

[3] その他の候補（必要に応じて）
    例: test(infrastructure): Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する
    （Emoji省略版）

どの候補を使用しますか？番号を指定するか、直接編集したメッセージを提供してください。
```

### ステップ3: ユーザーの選択・編集
- ユーザーが `1`、`2`、`3` などの番号を指定
- または、直接編集したメッセージを提供
- 選択/編集されたメッセージを確認表示

### ステップ4: コミット実行
```bash
git commit -m "選択/編集されたメッセージ"
```

## 使用例

```
ユーザー: このコマンドを実行してください

AI: ステージング内容を確認中...
    - 8 files changed, 1078 insertions(+), 11 deletions(-)

    コミットメッセージ候補:

    [1] test(infrastructure): 🧪 Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する

    [2] test(infrastructure): 🧪 Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する

        新規追加:
        - GmoWebSocketClient.test.ts (14 tests)
        - GmoAdapter.test.ts (14 tests)
        - WebSocketConnection.test.ts (15 tests)

        ディレクトリ構造の整理:
        - 既存テストファイルを src の構造に合わせて移動（git mv）
        - tests/README.md を更新

    どの候補を使用しますか？番号を指定するか、直接編集してください。

ユーザー: 2

AI: [2] のメッセージでコミットを実行します...
    git commit -m "test(infrastructure): 🧪 Infrastructure層のユニットテストを追加し、ディレクトリ構造を整理する..."

    コミットが完了しました。
```

## 注意事項

- ステージングされていない変更は含まれません
- コミット前に `git status` で確認することを推奨します
- コミットメッセージは50文字以内の要約行 + 詳細説明（必要に応じて）を推奨します
- 複数の候補を提示し、ユーザーが選択できるようにする

